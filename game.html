<!DOCTYPE html>
<html>
		<head>
		<title>Pagina Lenguaje Marcas</title>

			<link rel="preconnect" href="https://fonts.googleapis.com">
			<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
			<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

		<link rel="stylesheet" href="base.css"/>
		<link rel="stylesheet" href="game.css"/>
		
		<script>
		
		let game_data;
		
		let current_room = 0;
		let items_picked = [];
		
		function game (data)
		{
		
		game_data = data;
				
		document.getElementById("terminal").innerHTML = "<p><strong>¡Bienvenidos a ENTIerrame!</strong> Best juego de terror</p>";
		document.getElementById("terminal").innerHTML += "<p>Te encuentras en "+game_data.rooms[current_room].name+". ¿Que quieres hacer? </p>";
		}
		
		function terminal_out (info){
			let terminal = document.getElementById("terminal");
			terminal.innerHTML += info;
			terminal.scrollTop = terminal.scrollHeight;
		}
		
		function parseCommand (command){
			console.log("El comando ", command);
			switch (command){
			case "ver":
				terminal_out("<p>"game_data.rooms[current_room].description"</p>");
				break;
				
			case "ir":
				let doors = "";
				let doors_num = game_data.rooms[current_room].doors.length;
				
				for (let i = 0; i < doors_num; i++){
				doors += game_data.rooms[current_room].doors[i]+" ":
				}
				terminal_out("<p>Puedes ir a: "+doors+"</p>");
				break;
					
			default:
				terminal_out("<p><strong>ERROR</strong>: "+command+" comando no encontrado</p>");
			}
		}
		
		function getRoomNumber (room){
		for (let i = 0; i < game_data.rooms.length; i++){
		if (game_data.rooms[i].id == room){
		return i;
				}
			}
		
		return -1;
		}
		
		function getDoorNumber (door){
		for (let i = 0; i < game_data.doors.length; i++){
		if (game_data.doors[i].id == door){
		return i;
				}
			}
		
		return -1;
		}
		
		function parseInstruction (instruction){
			console.log("La instrucción", instruction);
			
			switch (instruction[0]){
			case "ver":
				
			break;
			
			case "ir":
				
				let door_num = getDoorNumber(instruction[1]);
				if (door_num < 0) {
				console.log("Puerta errónea");
				return;
				}
				
				let room_num = getRoomNumber(game_data.doors[door_num].rooms[0]);
				if (room_num == current_room){
				current_room = getRoomNumber(game_data.doors[door_num].rooms[1]);
				}
				else{
				current_room= room_num;
				}
			break;
			
			case "coger":
			
			break;
			
			default:
			terminal_out("<p><strong>ERROR</strong>:")
			}
		}
		
		function readAction(){
		 let instruction = document.getElementById("commands").value;
		 let instruction_trim instrucción.trim();
		 
		 let data = instruction.trim.split(" ");
		
		 if (data.length == 0 || instruction_trim == ""){
		 document.getElementById("terminal").innerHTML += "<p><strong>ERROR</strong>: escribe una instrucción</p>";
		 return;
		 }
		 
		 if (data.length == 1){
		   parseCommand(data[0]);
		}
		else{
			parseInstruction(data);
		}
		
		fetch("https://edsbru.github.io/game.json")
		.then(response => response.json())
		.then(data => game (data));
		
		</script>

		</head>
	<body>

	<header>
	<h1>Edu, pagina ENTI</h1>
	<nav>
	<ul id="main-menu">
	<li id="menu-presentation"><a href="index.html">Presentación</a></li>
	<li id="menu-hobbies"><a href="hobbies.html">Hobbies</a></li>
	<li id="menu-contact"><a href="contact.html">Contacto</a></li>
	<li id="menu-cv"><a href="cv.html">CV</a></li>
	<li id="menu-game"><a href="game.html">Game</a></li>
	</ul>
	</nav>
	</header>

	<main>

	<article>
	<h2>Artículo</h2>
	</article>

<form>
<div id="terminal"></div>
<input type="text" id="commands" />
<input type="submit" value="Acción" onclick="readAction(); return false;" />
</form>

	<aside>
	<h2>Lateral</h2>
	</aside>

	</main>

	<footer>
	<p>Edu Salazar (c) <span id="footer-year">2022</span></p>
	<script>
		document.getElementById("footer-year").innerHTML = new Date().getFullYear();
	</script>
	</footer>

	</body>
</html>